---
title: "Escolas Integrais em Pernambuco"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load(dplyr, leaflet, leaflet.extras, leaflet.minicharts, plotly, rgdal, tidyr)

escolas_integrais <- read.csv2('../../bases_tratadas/escolas_tempo_integral_v2.csv')

escolas_integrais$nome_escola <- as.factor(escolas_integrais$nome_escola)

escolas_integral_agg <- escolas_integrais %>% group_by(nome_escola, ano_implantacao, .drop=FALSE) %>% summarise(n = n()) %>% na.omit() %>% complete(ano_implantacao, nome_escola, fill = list(n = 0)) %>% filter(nome_escola != '') %>% distinct()

escolas_integrais_agg <- merge(escolas_integral_agg, escolas_integrais, by = 'nome_escola') %>% select(!ano_implantacao.y) %>% distinct()

escolas_integrais_ano <- escolas_integrais %>% group_by(ano_implantacao) %>% summarise(n = n()) %>% mutate(n_ant = lag(n))



```

## Evolução da Rede Integral

### Série Histórica

```{r echo=FALSE, warning=FALSE, message=FALSE}

plot_ly(escolas_integrais_ano, x = ~ano_implantacao) %>% add_trace(y = ~n_ant, name = 'ano anterior', mode = 'lines+markers') %>% add_trace(y = ~n, name = 'ano', mode = 'lines+markers')

```

### Mapa Interativo

```{r echo=FALSE, warning=FALSE, message=FALSE}

leaflet(escolas_integrais_agg) %>% addTiles() %>%
  addMinicharts(
    escolas_integrais_agg$lon, escolas_integrais_agg$lat,
    chartdata = escolas_integrais_agg$n,
    time = escolas_integrais_agg$ano_implantacao.x,
    showLabels = F,
    width = 15, height = 15
  ) %>%
  addFullscreenControl()

```